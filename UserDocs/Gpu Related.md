# Gpu 服务器相关注意事项

## 前言

当你使用Gpu服务器，你需要阅读本文档来获知哪些行为是危险的。当你确定这些行为是必须的时，请联系系统管理员。

## Gpu driver

### SMI

利用和驱动一同安装的SMI工具获得GPU运行状态和驱动信息。

```shell
➜  ~ nvidia-smi
Sun Apr  7 15:44:30 2024
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 510.39.01    Driver Version: 510.39.01    CUDA Version: 11.6     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  NVIDIA GeForce ...  Off  | 00000000:17:00.0 Off |                  N/A |
| 42%   23C    P8    26W / 350W |   1635MiB / 24576MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
|   1  NVIDIA GeForce ...  Off  | 00000000:CA:00.0 Off |                  N/A |
| 41%   24C    P8    23W / 350W |    975MiB / 24576MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+

+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|    0   N/A  N/A     18636      C   python                           1633MiB |
|    1   N/A  N/A     18636      C   python                            973MiB |
+-----------------------------------------------------------------------------+
```

### CUDA version

一个特定的GPU驱动版本(此处为510.39.01)对应一个特定的CUDA版本号。

### 两种API

+ Runtime API是面向应用程序开发者的高级API，提供了一组函数调用和运行时环境，用于管理GPU设备、内存分配、并行执行等。
+ Driver API是面向驱动程序和底层开发者的低级API，提供了对GPU硬件和驱动程序的更直接访问。

### 对应关系

Runtime api的版本是你所执行的实际ML/DL项目要求的CUDA version，因为这是应用程序调用cuda的接口。Runtime Api 需要保持对Driver Api的兼容。即一个Driver Api 只能对应同版本或者更旧的 Runtime Api。

![](https://alicloud-pic.oss-cn-shanghai.aliyuncs.com/NISL_docs/cuda_api.png)
 
一般来说，你可以通过conda来指定不用的runtime api 来适应不同的项目，这个过程发生你的用户目录下，不会对系统造成影响。而driver api和驱动版本对应，出于两方面原因，我们没有更新驱动的打算。
+ 3090并不能从cuda version 12.x 获得性能增益(4090推荐使用cuda12)
+ 机器的图形界面程序会在重启后强制恢复驱动版本为最初的状态，这是服务器提供商的设定。

### 禁忌

请不要更新驱动，或者变更**全局**的 nvcc 或 toolkit 的状态，如果你认为这很有必要，请联系管理员。
请不要更新驱动，或者变更**全局**的 nvcc 或 toolkit 的状态，如果你认为这很有必要，请联系管理员。
请不要更新驱动，或者变更**全局**的 nvcc 或 toolkit 的状态，如果你认为这很有必要，请联系管理员。

## conda

### conda的位置

你可能会遭遇这两种情况之一。
+ 你的机器有一个全局的conda供所有使用。
+ 你在自己的用户目录下安装了conda并且自行配置了环境变量。

对于任一情况，你都需要及时删除不常用的虚拟环境。
对于第二种情况，你最好将conda安装在/data软连接下以节约空间。

### 注意

当系统conda和用户conda同时存在时，注意其中可能发生的冲突问题。